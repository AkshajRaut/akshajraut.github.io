// SFX via WebAudio
const SFX = (()=>{let ctx,muted=false;function ensure(){if(!ctx)ctx=new (window.AudioContext||window.webkitAudioContext)()}function tone(f=440,d=.06,t='sine',v=.02){if(muted)return;ensure();const o=ctx.createOscillator(),g=ctx.createGain();o.type=t;o.frequency.value=f;g.gain.value=v;o.connect(g);g.connect(ctx.destination);o.start();o.stop(ctx.currentTime+d)}return{click:()=>tone(660,.05,'square',.03),unlock:()=>{tone(420,.08,'sine',.03);setTimeout(()=>tone(720,.08,'square',.03),90)},error:()=>tone(140,.12,'sawtooth',.03),setMuted:m=>{muted=m},isMuted:()=>muted}})();

// Animated grid BG
(function(){const c=document.getElementById('bg');const ctx=c.getContext('2d');let w,h,t=0;const DPR=Math.min(2,window.devicePixelRatio||1);function resize(){w=c.clientWidth;h=c.clientHeight;c.width=w*DPR;c.height=h*DPR;ctx.setTransform(DPR,0,0,DPR,0,0)}window.addEventListener('resize',resize);resize();function loop(){t+=.008;ctx.clearRect(0,0,w,h);ctx.strokeStyle='rgba(99,246,255,0.2)';ctx.lineWidth=1;const gap=40;const ox=(Math.sin(t)*.5+.5)*gap;const oy=(Math.cos(t*.8)*.5+.5)*gap;for(let x=-gap;x<w+gap;x+=gap){ctx.beginPath();ctx.moveTo(x+ox,0);ctx.lineTo(x+ox,h);ctx.stroke()}for(let y=-gap;y<h+gap;y+=gap){ctx.beginPath();ctx.moveTo(0,y+oy);ctx.lineTo(w,y+oy);ctx.stroke()}const r=(Math.sin(t*2)*.5+.5)*Math.max(w,h);const gx=w*.5,gy=h*.6;const grad=ctx.createRadialGradient(gx,gy,0,gx,gy,r);grad.addColorStop(0,'rgba(139,124,255,0.08)');grad.addColorStop(1,'transparent');ctx.fillStyle=grad;ctx.beginPath();ctx.arc(gx,gy,r,0,Math.PI*2);ctx.fill();requestAnimationFrame(loop)}loop()})();

// State and missions
const state={missions:[{id:'drone',name:'Autonomous AI Drone',tag:'UAV / PX4',desc:'Pixhawk PX4 + Raspberry Pi 4; EKF-tuned sensor fusion, GPS autonomy, LiDAR+RGB perception. Roadmap: Jetson + 360° LiDAR for SLAM.',bullets:['PX4 flight stack, custom EKF tuning','GPS point-to-point autonomy','LiDAR + camera obstacle avoidance'],links:[{label:'YouTube Demo',href:'https://youtu.be/cf-Sw53yA5E?si=Cjf-Ey51lNuXJp09'}],locked:false},{id:'slam360',name:'Omnidirectional Dense SLAM',tag:'360° / VO',desc:'Monocular SLAM with Insta360 ONE X2 video; OpenCV-based VO, trajectory estimation, sparse 3D reconstruction.',bullets:['Python + OpenCV pipeline','360° data handling','Sparse map + trajectory'],links:[],locked:false},{id:'yolov8',name:'Firearm Detection & Alerts',tag:'YOLOv8',desc:'Real-time firearm detection with finetuned YOLOv8 (mAP 0.87) and Twilio-based SMS/call alerts.',bullets:['Custom dataset, robust mAP 0.87','Live pipeline + alert integration'],links:[{label:'Demo Video',href:'https://youtu.be/AnZQ4tLCE10'}],locked:false},{id:'orbslam3',name:'ORB-SLAM3 on NUance Car',tag:'Stereo/IMU',desc:'Implemented ORB-SLAM3 on real NUance autonomous car data with stereo and stereo-inertial modes.',bullets:['Real-world datasets','Accurate 3D maps, localization'],links:[],locked:false},{id:'lidar',name:'Low-Cost LiDAR Sensor',tag:'ToF / 2D Map',desc:'Custom ToF-based LiDAR module with 3D-printed housing; on-vehicle 2D environment mapping prototype.',bullets:['Hardware + enclosure design','On-vehicle tests + mapping'],links:[{label:'GitHub Repo',href:'https://github.com/AkshajRaut/LIDAR'},{label:'Demo Video',href:'https://youtu.be/rRnFcgB8jcc'}],locked:false}],xp:0,startTime:Date.now(),theme:localStorage.getItem('theme')||'dark'};

const $=(s,r=document)=>r.querySelector(s);
const startScreen=$('#start');const app=$('#app');const beginBtn=$('#begin');const modal=$('#modal');const closeModalBtn=$('#closeModal');const modalTitle=$('#modalTitle');const modalDesc=$('#modalDesc');const modalBullets=$('#modalBullets');const modalLinks=$('#modalLinks');const grid=$('#grid');const mode=$('#mode');const uptime=$('#uptime');const xpEl=$('#xp');const unlockedCount=$('#unlockedCount');const totalCount=$('#totalCount');const muteBtn=$('#mute');const resetBtn=$('#reset');const toggleTheme=$('#toggleTheme');

function init(){document.getElementById('year').textContent=new Date().getFullYear();totalCount.textContent=state.missions.length.toString();if(state.theme==='light')document.documentElement.classList.add('light');grid.innerHTML='';state.missions.forEach(m=>grid.appendChild(makeCard(m)));beginBtn.addEventListener('click',startGame);document.addEventListener('keydown',e=>{if(e.key==='Enter'&&(app.classList.contains('hidden')))startGame()});closeModalBtn.addEventListener('click',hideModal);modal.addEventListener('click',e=>{if(e.target===modal)hideModal()});muteBtn.addEventListener('click',toggleMute);resetBtn.addEventListener('click',resetProgress);toggleTheme.addEventListener('click',e=>{e.preventDefault();document.documentElement.classList.toggle('light');const isLight=document.documentElement.classList.contains('light');localStorage.setItem('theme',isLight?'light':'dark')});setInterval(tick,1000);updateCounters()}document.addEventListener('DOMContentLoaded',init);

function startGame(){SFX.click();startScreen.classList.add('hidden');app.classList.remove('hidden');mode.textContent='ACTIVE'}
function tick(){const secs=Math.floor((Date.now()-state.startTime)/1000);const mm=String(Math.floor(secs/60)).padStart(2,'0');const ss=String(secs%60).padStart(2,'0');uptime.textContent=`${mm}:${ss}`}
function updateCounters(){const unlocked=state.missions.filter(m=>!m.locked).length;unlockedCount.textContent=unlocked.toString();xpEl.textContent=(unlocked*100).toString()}

function makeCard(m){const card=document.createElement('div');card.className='card '+(m.locked?'locked':'unlocked');card.setAttribute('role','button');card.setAttribute('tabindex','0');card.innerHTML=`<div class="head"><div class="name">${m.name}</div><div class="tag">${m.tag}</div></div><div class="desc">${m.desc}</div><div class="pulse" aria-hidden="true"></div>`;const open=()=>openMission(m);card.addEventListener('click',open);card.addEventListener('keydown',e=>{if(e.key==='Enter')open()});return card}
function openMission(m){SFX.click();modalTitle.textContent=m.name;modalDesc.textContent=m.desc;modalBullets.innerHTML='';m.bullets.forEach(b=>{const li=document.createElement('li');li.textContent=b;modalBullets.appendChild(li)});modalLinks.innerHTML='';m.links.forEach(l=>{const a=document.createElement('a');a.href=l.href;a.textContent=l.label;a.target='_blank';a.rel='noopener';modalLinks.appendChild(a)});modal.classList.remove('hidden')}
function hideModal(){modal.classList.add('hidden')}
function toggleMute(){const now=!SFX.isMuted();SFX.setMuted(now);muteBtn.textContent=`SFX: ${now?'OFF':'ON'}`}
function resetProgress(){SFX.error();localStorage.clear();state.theme='dark';document.documentElement.classList.remove('light');updateCounters()}
document.addEventListener('keydown',e=>{if(!modal.classList.contains('hidden')&&e.key==='Escape'){hideModal()}});